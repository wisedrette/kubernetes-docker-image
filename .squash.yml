deployments:
  ghost:
    deployment_type: kubernetes
    install:
      - kubectl delete deployment -l app=redis
      - kubectl delete service -l app=redis
      - kubectl delete deployment -l app=guestbook
      - kubectl delete service -l app=guestbook
      - kubectl apply -f https://k8s.io/examples/application/guestbook/redis-master-deployment.yaml
      - kubectl apply -f https://k8s.io/examples/application/guestbook/redis-master-service.yaml
      - kubectl apply -f https://k8s.io/examples/application/guestbook/redis-slave-deployment.yaml
      - kubectl apply -f https://k8s.io/examples/application/guestbook/redis-slave-service.yaml
      - kubectl apply -f https://k8s.io/examples/application/guestbook/frontend-deployment.yaml
      - kubectl apply -f https://k8s.io/examples/application/guestbook/frontend-service.yaml
      - sleep 40
      - kubectl port-forward svc/frontend 80:80 --address 0.0.0.0
